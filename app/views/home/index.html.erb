<div class="three-pane-layout"
     data-controller="keyboard selection pin help-dialog mobile-pane"
     data-pin-selection-outlet=".three-pane-layout"
     data-mobile-pane="feeds"
     data-action="keyboard:next-entry->selection#nextEntry
                  keyboard:previous-entry->selection#previousEntry
                  keyboard:next-feed->selection#nextFeed
                  keyboard:previous-feed->selection#previousFeed
                  keyboard:scroll-entry-detail-down->selection#scrollEntryDetailDown
                  keyboard:scroll-entry-detail-up->selection#scrollEntryDetailUp
                  keyboard:open-entry-in-new-tab->selection#openEntryInNewTab
                  keyboard:toggle-pin->pin#togglePin
                  keyboard:open-pinned->pin#openPinned
                  keyboard:mark-all-as-read->selection#markAllAsRead
                  keyboard:reload-page->selection#reloadPage
                  keyboard:open-hatena-bookmark->selection#openHatenaBookmark
                  keyboard:open-hatena-bookmark-add->selection#openHatenaBookmarkAdd
                  keyboard:toggle-help->help-dialog#toggle">
  <!-- Left pane: Feed list -->
  <aside class="feed-list-pane">
    <div class="pane-header">
      <h1>Tsubame</h1>
      <div class="pane-header-links">
        <%= link_to pinned_entries_path, data: { turbo_frame: "entry_list" }, class: "pin-list-link" do %>
          📌 ピン一覧
          <span id="pin_badge">
            <% if @pinned_count > 0 %>
              <span class="pin-badge"><%= @pinned_count %></span>
            <% end %>
          </span>
        <% end %>
        <%= link_to "フィード管理", feeds_path, class: "feed-manage-link" %>
      </div>
    </div>

    <div class="feed-list" data-selection-target="feedList">
      <% if @feeds.any? %>
        <% @feeds.each do |feed| %>
          <%= link_to feed_entries_path(feed), data: { turbo_frame: "entry_list", feed_id: feed.id }, class: "feed-item", tabindex: "-1" do %>
            <span class="feed-title"><%= feed.title || feed.url %></span>
            <% if feed.unread_count > 0 %>
              <span class="unread-badge"><%= feed.unread_count %></span>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <p class="empty-message">フィードがありません。<%= link_to "OPMLをインポート", new_feed_import_path %>してください。</p>
      <% end %>
    </div>
  </aside>

  <!-- Right pane: Entry list and detail -->
  <div class="content-pane">
    <!-- Top: Entry list -->
    <section class="entry-list-pane" data-selection-target="entryList">
      <%= turbo_frame_tag "entry_list" do %>
        <div class="empty-message">
          <p>左からフィードを選択してください</p>
        </div>
      <% end %>
    </section>

    <!-- Bottom: Entry detail -->
    <section class="entry-detail-pane" data-selection-target="entryDetail">
      <%= turbo_frame_tag "entry_detail" do %>
        <div class="empty-message">
          <p>エントリを選択してください</p>
        </div>
      <% end %>
    </section>
  </div>

  <dialog class="help-dialog" data-help-dialog-target="dialog">
    <div class="help-dialog-header">
      <h2>キーボードショートカット</h2>
      <button class="help-dialog-close" aria-label="ヘルプを閉じる" data-action="click->help-dialog#close">✕</button>
    </div>

    <h3>フィードナビゲーション</h3>
    <table>
      <tbody>
        <tr><td><kbd>s</kbd></td><td>次のフィード</td></tr>
        <tr><td><kbd>a</kbd></td><td>前のフィード</td></tr>
        <tr><td><kbd>r</kbd></td><td>ページ再読み込み</td></tr>
      </tbody>
    </table>

    <h3>エントリナビゲーション</h3>
    <table>
      <tbody>
        <tr><td><kbd>j</kbd></td><td>次のエントリ</td></tr>
        <tr><td><kbd>k</kbd></td><td>前のエントリ</td></tr>
        <tr><td><kbd>Space</kbd></td><td>エントリ詳細をスクロールダウン</td></tr>
        <tr><td><kbd>Shift+Space</kbd></td><td>エントリ詳細をスクロールアップ</td></tr>
      </tbody>
    </table>

    <h3>アクション</h3>
    <table>
      <tbody>
        <tr><td><kbd>v</kbd></td><td>エントリを新タブで開く</td></tr>
        <tr><td><kbd>p</kbd></td><td>ピン追加/解除</td></tr>
        <tr><td><kbd>o</kbd></td><td>ピン留めエントリを新タブで開く</td></tr>
        <tr><td><kbd>Shift+A</kbd></td><td>現在のフィードを全既読</td></tr>
        <tr><td><kbd>b</kbd></td><td>はてなブックマークページを開く</td></tr>
        <tr><td><kbd>h</kbd></td><td>はてなブックマークに追加</td></tr>
      </tbody>
    </table>

    <h3>その他</h3>
    <table>
      <tbody>
        <tr><td><kbd>?</kbd></td><td>このヘルプを表示/非表示</td></tr>
      </tbody>
    </table>
  </dialog>
</div>
